
<title>D'Amato Design System</title>
<link rel="icon" type="image/svg+xml" href="./favicon.svg">
<link rel="shortcut icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
<link rel="shortcut icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">

<style>
    @font-face {
        font-family: 'Monaspace Radon', monospace;
        src: url(https://cdn.jsdelivr.net/gh/githubnext/monaspace@v1.000/fonts/webfonts/MonaspaceRadon-Regular.woff);
    }

    .sidebar-item {
        &[data-selected="true"][data-highlightable="true"] {
            color: #222425;
        }

        a {
            padding-block: .5em;
            text-transform: capitalize;
        }

        svg {
            display: none;
        }
    }

    pre, code {
        font-family: 'Monaspace Radon', monospace;
    }

    #storybook-explorer-searchfield {
        visibility: hidden;
        animation: appear 0s linear forwards;
    }

    @keyframes appear { to { visibility: visible; } }

    iframe {
        visibility: hidden;
        animation: appear 0s linear forwards;
    }

</style>

<script>

    /*  ========== Replace page title ========== */    

    const title = document.querySelector('title');

    new MutationObserver(([entry]) => {
        if (title.textContent.includes('Storybook')) {
            title.textContent = title.textContent.replace('Docs â‹… Storybook', `DAMATO Design System`)
        }
}).observe(
    title,
    { subtree: true, characterData: true, childList: true }
);

    /*  ========== Wait for DOM nodes ========== */

    window.addEventListener('animationend', (ev) => {
        if (ev.animationName === 'appear') {
            if (ev.target.tagName === 'INPUT') handleInput(ev.target);
            if (ev.target.tagName === 'IFRAME') handleIframe(ev.target);
        }
    });

    /*  ========== Update placeholder in search ========== */

    function handleInput(input) {
        updatePlaceholder(input);
        new MutationObserver(([entry]) => updatePlaceholder(input))
            .observe(
                input,
                { attributes: true, attributeFilter: ['placeholder'], subtree: true,
                childList: true, }
            );
    }

    function updatePlaceholder(node) {
        if (node.getAttribute('placeholder').includes('components')) {
            node.setAttribute('placeholder', 'Search docs');
        }
    }

    /*  ========== Update iframe heights to match content ========== */

    function handleIframe($iframe) {
        if ($iframe.id === 'storybook-preview-iframe') {
            $iframe.addEventListener('load', preview);
            preview.call($iframe);
            return;
        }
        $iframe.addEventListener('load', () => {
            const observer = new ResizeObserver(([entry]) => {
                if (!entry.contentRect.height) return;
                adjustHeight($iframe, entry.target);
                observer.unobserve(entry.target);
            });
            observer.observe($iframe.contentWindow.document.body);
        });
        reload.call($iframe);
    }

    function reload() {
        const src = this.src;
        this.removeAttribute('src');
        this.removeAttribute('loading');
        this.src = src;
    }

    function adjustHeight($iframe, $body) {
        const adjustedHeight = $body.scrollHeight;
        const currentHeight = $iframe.parentElement.style.height;
        if (currentHeight !== '400px' || !adjustedHeight) return;
        $iframe.parentElement.style.height = `${adjustedHeight}px`;
        $iframe.parentElement.setAttribute('data-adjusted', '');
    }

    function preview() {
        const doc = (this?.contentDocument)
            ? this.contentDocument
            : this.contentWindow.document;

        this.contentWindow.addEventListener('animationend', (ev) => {
            if (ev.animationName === 'appear') {
                if (ev.target.tagName === 'IFRAME') handleIframe(ev.target);
            }
        });
    }
</script>
